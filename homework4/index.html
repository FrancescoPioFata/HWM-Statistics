<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homework 4 - Law of Large Numbers</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #f1f1f1;
            background: linear-gradient(rgba(10, 10, 10, 0.9), rgba(10, 10, 10, 0.9)),
                        url('https://plus.unsplash.com/premium_photo-1714618828448-abf8732500c6?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=3000') no-repeat center center fixed;
            background-size: cover;
        }

        header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        h1 {
            font-size: 2.7rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        main {
            padding: 3rem 0;
        }

        .content-box {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            background: rgba(20, 20, 30, 0.85);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        section {
            background: rgba(25, 25, 35, 0.9);
            margin-bottom: 2rem;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.6);
        }

        h2 {
            color: #3b82f6;
            margin-bottom: 1rem;
            font-size: 2.0rem;
            border-bottom: 2px solid #1e3a8a;
            padding-bottom: 0.5rem;
        }

        h3 {
            color: #3b82f6;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            font-size: 1.4rem;
        }

        p {
            margin-bottom: 1.2rem;
        }

        strong {
            color: #334f9f;
        }

        .demo-section {
            background: rgba(30, 30, 40, 0.9);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid #3b82f6;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #3b82f6;
            font-weight: bold;
        }

        input[type="number"],
        input[type="range"] {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #3b82f6;
            border-radius: 4px;
            background: rgba(15, 15, 25, 0.8);
            color: #f1f1f1;
            font-size: 1rem;
        }

        input[type="range"] {
            padding: 0;
            height: 40px;
        }

        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        button:hover {
            background-color: #1e3a8a;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.2);
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .chart-container {
            background: rgba(15, 15, 25, 0.9);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            position: relative;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        canvas {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .value-display {
            display: inline-block;
            background: rgba(59, 130, 246, 0.3);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .stats-box {
            background: rgba(59, 130, 246, 0.15);
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
        }

        .back-home-box {
            display: flex;
            justify-content: center;
            margin-top: 3rem;
        }

        .back-home-link {
            background-color: #3b82f6;
            color: #ffffff;
            text-decoration: none;
            font-weight: bold;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        .back-home-link:hover {
            background-color: #1e3a8a;
            transform: scale(1.05);
        }

        footer {
            background: #0f172a;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.6);
        }

        ul {
            margin-left: 2rem;
            margin-bottom: 1.2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        .formula {
            background: rgba(15, 15, 25, 0.9);
            padding: 1rem;
            border-radius: 4px;
            border-left: 4px solid #3b82f6;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            color: #a5d6ff;
            text-align: center;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üìä Homework 4 - Law of Large Numbers</h1>
            <p class="subtitle">Interactive Simulation & Convergence Visualization</p>
        </div>
    </header>

    <main>
        <article class="content-box">
            <h2>The Law of Large Numbers</h2>
            
            <p>
                The <strong>Law of Large Numbers (LLN)</strong> is one of the fundamental theorems in probability theory and statistics. It states that as the number of trials in a random experiment increases, the sample average (or empirical frequency) converges to the expected value (or theoretical probability).
            </p>

            <p>
                In simpler terms: if you repeat an experiment many times, the average of the results will get closer and closer to the expected value. For example, if you flip a fair coin many times, the proportion of heads will approach 0.5 (50%).
            </p>

            <div class="info-box">
                <strong>üéØ Key Concepts:</strong>
                <ul>
                    <li><strong>Theoretical Probability (p):</strong> The expected probability of success (e.g., 0.5 for a fair coin)</li>
                    <li><strong>Empirical Frequency f(n):</strong> The observed proportion of successes after n trials</li>
                    <li><strong>Convergence:</strong> As n ‚Üí ‚àû, f(n) ‚Üí p</li>
                    <li><strong>Trajectories:</strong> Different simulation paths showing how f(n) evolves over time</li>
                </ul>
            </div>

            <div class="formula">
                f(n) = (Number of Successes up to trial n) / n ‚Üí p as n ‚Üí ‚àû
            </div>

            <h2>Interactive Simulation</h2>

            <div class="demo-section">
                <h3>Simulation Parameters</h3>
                
                <div class="controls-grid">
                    <div class="form-group">
                        <label for="numTrajectories">
                            Number of Trajectories: 
                            <span class="value-display" id="numTrajDisplay">10</span>
                        </label>
                        <input type="range" id="numTrajectories" min="1" max="50" value="10" 
                               oninput="document.getElementById('numTrajDisplay').textContent = this.value">
                    </div>

                    <div class="form-group">
                        <label for="numTrials">
                            Number of Trials (n): 
                            <span class="value-display" id="numTrialsDisplay">1000</span>
                        </label>
                        <input type="range" id="numTrials" min="100" max="5000" step="100" value="1000"
                               oninput="document.getElementById('numTrialsDisplay').textContent = this.value">
                    </div>

                    <div class="form-group">
                        <label for="probability">
                            Success Probability (p): 
                            <span class="value-display" id="probDisplay">0.50</span>
                        </label>
                        <input type="range" id="probability" min="0" max="1" step="0.01" value="0.5"
                               oninput="document.getElementById('probDisplay').textContent = parseFloat(this.value).toFixed(2)">
                    </div>

                    <div class="form-group">
                        <label for="speed">
                            Animation Speed: 
                            <span class="value-display" id="speedDisplay">Medium</span>
                        </label>
                        <input type="range" id="speed" min="1" max="3" value="2"
                               oninput="updateSpeedDisplay(this.value)">
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="startSimulation()" id="startBtn">‚ñ∂ Start Simulation</button>
                    <button onclick="pauseSimulation()" id="pauseBtn" disabled>‚è∏ Pause</button>
                    <button onclick="resetSimulation()" id="resetBtn">‚Üª Reset</button>
                </div>

                <div class="stats-box" id="statsBox" style="display: none;">
                    <div class="stat-item">
                        <span class="stat-value" id="currentTrial">0</span>
                        <span class="stat-label">Current Trial</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgFrequency">0.000</span>
                        <span class="stat-label">Avg. Frequency</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="deviation">0.000</span>
                        <span class="stat-label">Deviation from p</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="variance">0.000</span>
                        <span class="stat-label">Variance</span>
                    </div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h3 style="text-align: center; margin-bottom: 1rem;">Convergence Trajectories</h3>
                    <canvas id="trajectoryChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3 style="text-align: center; margin-bottom: 1rem;">Final Distribution</h3>
                    <canvas id="histogramChart"></canvas>
                </div>
            </div>

            <div class="info-box" style="margin-top: 2rem;">
                <strong>üìñ How to Interpret:</strong>
                <ul>
                    <li><strong>Left Chart (Trajectories):</strong> Each colored line shows one simulation path. As trials increase, all lines converge toward the theoretical probability (red dashed line).</li>
                    <li><strong>Right Chart (Histogram):</strong> Shows the distribution of final frequencies across all trajectories. It should cluster around the theoretical probability.</li>
                    <li><strong>Statistics Panel:</strong> Displays real-time metrics showing how close the simulations are to the expected value.</li>
                </ul>
            </div>

            <h2>Mathematical Foundation</h2>

            <p>
                The <strong>Weak Law of Large Numbers</strong> states that for a sequence of independent and identically distributed (i.i.d.) random variables X‚ÇÅ, X‚ÇÇ, ..., X‚Çô with expected value Œº:
            </p>

            <div class="formula">
                lim(n‚Üí‚àû) P(|XÃÑ‚Çô - Œº| > Œµ) = 0, for any Œµ > 0
            </div>

            <p>
                Where XÃÑ‚Çô = (X‚ÇÅ + X‚ÇÇ + ... + X‚Çô) / n is the sample mean. This means that the probability that the sample mean deviates from the expected value by more than any small amount Œµ approaches zero as n increases.
            </p>

            <p>
                The <strong>Strong Law of Large Numbers</strong> makes an even stronger statement:
            </p>

            <div class="formula">
                P(lim(n‚Üí‚àû) XÃÑ‚Çô = Œº) = 1
            </div>

            <p>
                This guarantees that the sample mean converges to the expected value with probability 1 (almost surely).
            </p>

            <h3>Practical Applications</h3>
            <ul>
                <li><strong>Insurance & Risk Assessment:</strong> Predicting claim frequencies based on large pools of policyholders</li>
                <li><strong>Quality Control:</strong> Estimating defect rates from sample inspections</li>
                <li><strong>Casino Gaming:</strong> Understanding why "the house always wins" in the long run</li>
                <li><strong>Scientific Research:</strong> Improving measurement accuracy through repeated experiments</li>
                <li><strong>Financial Markets:</strong> Portfolio diversification and risk management</li>
            </ul>
        </article>

        <div class="back-home-box">
            <a href="../index.html" class="back-home-link">‚Üê Back to Home</a>
        </div>
    </main>

    <footer>
        <hr>
        <p><small>&copy; 2025 Francesco Pio Fata ‚Äì Homework 4</small></p>
    </footer>

    <script>
        let trajectoryChart, histogramChart;
        let simulationData = [];
        let animationFrame;
        let currentStep = 0;
        let isRunning = false;
        let isPaused = false;

        function updateSpeedDisplay(value) {
            const speeds = ['Slow', 'Medium', 'Fast'];
            document.getElementById('speedDisplay').textContent = speeds[value - 1];
        }

        function initCharts() {
            const trajectoryCtx = document.getElementById('trajectoryChart').getContext('2d');
            const histogramCtx = document.getElementById('histogramChart').getContext('2d');

            trajectoryChart = new Chart(trajectoryCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    animation: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'Number of Trials (n)',
                                color: '#3b82f6'
                            },
                            ticks: { color: '#aaa' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Empirical Frequency f(n)',
                                color: '#3b82f6'
                            },
                            min: 0,
                            max: 1,
                            ticks: { color: '#aaa' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        }
                    }
                }
            });

            histogramChart = new Chart(histogramCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Frequency',
                        data: [],
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 1,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: true }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'Final f(n)',
                                color: '#3b82f6'
                            },
                            ticks: { color: '#aaa' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Count',
                                color: '#3b82f6'
                            },
                            ticks: { color: '#aaa' },
                            grid: { color: 'rgba(59, 130, 246, 0.1)' }
                        }
                    }
                }
            });
        }

        function generateColors(n) {
            const colors = [];
            for (let i = 0; i < n; i++) {
                const hue = (i * 360 / n) % 360;
                colors.push(`hsla(${hue}, 70%, 60%, 0.7)`);
            }
            return colors;
        }

        function startSimulation() {
            if (isRunning && !isPaused) return;

            if (!isPaused) {
                resetSimulation();
                
                const numTraj = parseInt(document.getElementById('numTrajectories').value);
                const numTrials = parseInt(document.getElementById('numTrials').value);
                const p = parseFloat(document.getElementById('probability').value);

                // Generate all simulation data upfront
                simulationData = [];
                for (let t = 0; t < numTraj; t++) {
                    const trajectory = [];
                    let successes = 0;
                    
                    for (let n = 1; n <= numTrials; n++) {
                        if (Math.random() < p) successes++;
                        trajectory.push(successes / n);
                    }
                    
                    simulationData.push(trajectory);
                }

                // Setup chart
                const colors = generateColors(numTraj);
                trajectoryChart.data.labels = Array.from({length: numTrials}, (_, i) => i + 1);
                trajectoryChart.data.datasets = simulationData.map((traj, i) => ({
                    label: `Trajectory ${i + 1}`,
                    data: new Array(numTrials).fill(null),
                    borderColor: colors[i],
                    backgroundColor: colors[i],
                    borderWidth: 1.5,
                    pointRadius: 0,
                    tension: 0.1
                }));

                // Add theoretical probability line
                trajectoryChart.data.datasets.push({
                    label: 'Theoretical p',
                    data: new Array(numTrials).fill(p),
                    borderColor: 'rgba(239, 68, 68, 0.8)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    tension: 0
                });

                currentStep = 0;
            }

            isRunning = true;
            isPaused = false;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('statsBox').style.display = 'grid';

            animate();
        }

        function animate() {
            if (!isRunning || isPaused) return;

            const numTrials = parseInt(document.getElementById('numTrials').value);
            const speed = parseInt(document.getElementById('speed').value);
            const stepsPerFrame = speed === 1 ? 1 : speed === 2 ? 5 : 20;

            for (let s = 0; s < stepsPerFrame && currentStep < numTrials; s++) {
                // Update trajectory data
                for (let t = 0; t < simulationData.length; t++) {
                    trajectoryChart.data.datasets[t].data[currentStep] = simulationData[t][currentStep];
                }
                currentStep++;
            }

            trajectoryChart.update('none');
            updateStats();

            if (currentStep >= numTrials) {
                finishSimulation();
            } else {
                animationFrame = requestAnimationFrame(animate);
            }
        }

        function updateStats() {
            const p = parseFloat(document.getElementById('probability').value);
            const currentValues = simulationData.map(traj => traj[currentStep - 1]);
            const avg = currentValues.reduce((a, b) => a + b, 0) / currentValues.length;
            const variance = currentValues.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / currentValues.length;

            document.getElementById('currentTrial').textContent = currentStep;
            document.getElementById('avgFrequency').textContent = avg.toFixed(4);
            document.getElementById('deviation').textContent = Math.abs(avg - p).toFixed(4);
            document.getElementById('variance').textContent = variance.toFixed(4);
        }

        function finishSimulation() {
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;

            // Update histogram with final values
            const finalValues = simulationData.map(traj => traj[traj.length - 1]);
            const bins = 20;
            const min = Math.min(...finalValues);
            const max = Math.max(...finalValues);
            const binWidth = (max - min) / bins;

            const histogram = new Array(bins).fill(0);
            const binLabels = [];

            for (let i = 0; i < bins; i++) {
                const binStart = min + i * binWidth;
                const binEnd = binStart + binWidth;
                binLabels.push(binStart.toFixed(3));
                
                for (const val of finalValues) {
                    if (val >= binStart && val < binEnd) histogram[i]++;
                }
            }

            histogramChart.data.labels = binLabels;
            histogramChart.data.datasets[0].data = histogram;
            histogramChart.update();
        }

        function pauseSimulation() {
            isPaused = true;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            cancelAnimationFrame(animationFrame);
        }

        function resetSimulation() {
            isRunning = false;
            isPaused = false;
            currentStep = 0;
            simulationData = [];
            
            cancelAnimationFrame(animationFrame);
            
            trajectoryChart.data.datasets = [];
            trajectoryChart.update();
            
            histogramChart.data.labels = [];
            histogramChart.data.datasets[0].data = [];
            histogramChart.update();
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('statsBox').style.display = 'none';
        }

        // Initialize charts on page load
        window.addEventListener('load', initCharts);
    </script>
</body>
</html>